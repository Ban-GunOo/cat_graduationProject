{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
      
      
      #all_wrap{
        margin:2.5%;
        width:90%;
        height:90%;
      }
      .selecting_tools{
        float:left;
        margin:0;
        width:30%;
      }

      #add_room{
        width:100px;
        height:100px;
        background-color:rgb(145, 145, 145);
        color:rgb(224, 224, 224);
        border:8px dashed grey;
        font-size:60px;
        text-align:center;
        margin:5px;
        cursor:pointer;
        float:left;
      }

      #draw_room{
        margin-left:10px;
        margin-top:10px;
        width:40vw;
        height:40vw;
       
        
      }

    

      .room_one_element{
          width:3.3%;
          height:3.3%;
          float:left;
          background-color:green;
          color:green;
          
          
      }

      .room_structure{
        width:100px;
        height:100px;
        background-color:black;
        color:white;
        cursor:default;
        font-size:70px;
        text-align:center;
        float:left;
        margin:5px;
      }

      .trash_can{
        width:100px;
        height:100px;
        background-repeat: no-repeat;
        background-image: url("{%static 'svgs/trash-can-solid.svg' %}");
        background-position:center;
        float:left;
        margin:5px;
      }

      #room_main_panel{
        float:left;
        margin-left:100px;
        border:1px solid #ddd
      }

      #room_text_area{
        margin-left:10px;
        margin-top:10px;
        margin-bottom:10px;
        margin-right:10px;
        width:40vw;
        height:40vw;
      }

      
      /*모든 한 요소 통틀어서 여기에서 */
      .room_element{
        width:100px;
        height:100px;
      }

      .furniture{
        background-color:red;
      }

     

      
      
    </style>

    <link rel="stylesheet" href="{%static 'css/bootstrap.css' %}">
    <link rel="stylesheet" href="{%static 'css/bootstrap.vertical-tabs.min.css' %}">
    <link rel="stylesheet" href="{%static 'css/all.css' %}">
    <link rel="stylesheet" href="{%static 'js/all.js' %}">


    
</head>
<body>
  <div id="all_wrap" class="container-fluid">
    <div class="panel-group selecting_tools" id="accordion" role="tablist" aria-multiselectable="true">
      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="headingOne">
          <h4 class="panel-title text-center">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
              방 추가
            </a>
          </h4>
        </div>
        <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
          <div id="room_add_parent" class="panel-body">
            <div id="add_room">+</div>
            <div class="trash_can" ondragover="allow_room_structure_drop();" ondrop="drop_room_strucutre_to_trash();"></div>
          </div>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="headingTwo">
          <h4 class="panel-title text-center">
            <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
              다른거 메뉴
            </a>
          </h4>
        </div>
        <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            <div class="room_element furniture"></div>
          </div>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="headingThree">
          <h4 class="panel-title text-center">
            <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
              다른거 메뉴
            </a>
          </h4>
        </div>
        <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            
          </div>
        </div>
      </div>
      
    </div>
    
    <div role="tabpanel" id="room_main_panel">
      <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active">
          <a href="#draw_room" aria-controls="draw" role="tab" data-toggle="tab">시각화 도구</a>
        </li>
        <li>
          <a href="#text_room" aria-controls="draw" role="tab" data-toggle="tab">리뷰 작성</a>
        </li>
      </ul>
      <div class="tab-content">
        <div role="tabpanel" class="tab-pane fade in active" id="draw_room">
            <script type="text/javascript">
                for (var i = 0;i<900;i++)
                    document.write('<div class="room_one_element"></div>');
            </script>
            
        </div>
        <div role="tabpanel" class="tab-pane fade" id="text_room">
          <textarea id="room_text_area" class="form-control" cols="30" rows="10"></textarea>
        </div>
      </div>
      <button type="button" class="btn btn-success btn-lg submit_button">저장</button>
    </div>
  </div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="{%static 'js/bootstrap.js' %}"></script>
<script>
  //방구조 개수 함수
  var structure_number = 1
  var current_room_structure = -1
  var drag_started = 0

  //구조 드래그 시작, 끝지점 xy좌표 저장
  var room_sturcture_drag_start_x
  var room_structure_drag_start_y
  var room_sturcture_drag_end_x
  var room_structure_drag_end_y

  //드래그시 미리보기 좌표 네개
  var temp_drag_x1 = -1
  var temp_drag_y1 = -1
  var temp_drag_x2 = -1
  var temp_drag_y2 = -1

  //코드 저장하는 배열 4개 단위로 저장
  var room_structure_code = []

  //현재 드래그하는 element
  current_dragging_element = -1


  var draw_room_box = document.getElementById("draw_room")
  var change_value = document.getElementById("temp_for_location")

  

  function get_size(){
    var size = document.getElementById("temp_for_size")
    size.innerHTML = "width : " + draw_box_width + ", height : "+ draw_box_height;
  }

  function change_color(event){
    var text = event.target.textContent
    console.log(text)
  }
  

  //마우스 클릭시 x,y좌표 저장
  $(".room_one_element").mousedown(function(e){
    drag_started = 1

    //강조표시 해제
    highlight_room_structure(current_room_structure,'none')

    var number = $(".room_one_element").index(this);

    e.preventDefault()
    //0,0에서 29,29까지
    //밑으로몇칸이 x 
    //오른쪽으로 몇칸이 y
    room_structure_drag_start_x = parseInt(number/30)
    room_structure_drag_start_y = number % 30


  });

  //마우스 끄는동안 미리보기 생성
  $(".room_one_element").mouseenter(function(e){
   
    
    if(current_room_structure!=-1 && drag_started==1)
    {
      var number = $(".room_one_element").index(this);
      //배열에 있는 나머지 다시 색칠
    print_all_room_structure()
      
      if(temp_drag_x1 != -1 && temp_drag_y1 != -1)
      {
        print_color("green", temp_drag_x1,temp_drag_y1,temp_drag_x2,temp_drag_y2)
      }

      e.preventDefault()
      var x1
      var x2
      var y1
      var y2
      var number = $(".room_one_element").index(this);

      room_structure_drag_end_x = parseInt(number/30)
      room_structure_drag_end_y = number % 30

      if(room_structure_drag_start_x <= room_structure_drag_end_x){
        x1 = room_structure_drag_start_x
        x2 = room_structure_drag_end_x
      }else{
        x1 = room_structure_drag_end_x
        x2 = room_structure_drag_start_x
      }

      if(room_structure_drag_start_y <= room_structure_drag_end_y){
        y1 = room_structure_drag_start_y
        y2 = room_structure_drag_end_y
      }else{
        y1 = room_structure_drag_end_y
        y2 = room_structure_drag_start_y
      }

      temp_drag_x1 = x1
      temp_drag_y1 = y1
      temp_drag_x2 = x2
      temp_drag_y2 = y2

      print_color("red", x1,y1,x2,y2)
    }
    
  });



  //마우스 놓으면 시작위치부터 놓은 위치까지 색칠
  $(".room_one_element").mouseup(function(){
    drag_started = 0
    var x1
    var x2
    var y1
    var y2
    var number = $(".room_one_element").index(this);

    $('.room_one_element').css('border', 'none')

    room_structure_drag_end_x = parseInt(number/30)
    room_structure_drag_end_y = number % 30

    if(room_structure_drag_start_x <= room_structure_drag_end_x){
      x1 = room_structure_drag_start_x
      x2 = room_structure_drag_end_x
    }else{
      x1 = room_structure_drag_end_x
      x2 = room_structure_drag_start_x
    }

    if(room_structure_drag_start_y <= room_structure_drag_end_y){
      y1 = room_structure_drag_start_y
      y2 = room_structure_drag_end_y
    }else{
      y1 = room_structure_drag_end_y
      y2 = room_structure_drag_start_y
    }

    if(room_structure_code[current_room_structure]==0)
    {
      room_structure_code[current_room_structure] = new Array(x1,y1,x2,y2)
      print_color("yellow", x1,y1,x2,y2)
    }
    else
    {
      print_color("green", room_structure_code[current_room_structure][0],room_structure_code[current_room_structure][1],room_structure_code[current_room_structure][2],room_structure_code[current_room_structure][3])
      room_structure_code[current_room_structure] = new Array(x1,y1,x2,y2)
      print_color("yellow", x1,y1,x2,y2)
    }

    //배열에 있는 나머지 다시 색칠
    print_all_room_structure()
    

    highlight_room_structure(current_room_structure, "5px solid black")
    console.log(current_room_structure)
    temp_drag_x1 = -1
    temp_drag_y1 = -1
    temp_drag_x2 = -1
    temp_drag_y2 = -1

    
  });


  //방 구조 배열 내부 모든 영역 색칠하는 함수
  function print_all_room_structure(){
    for(var i =0;i<room_structure_code.length;i++)
      {
        x1 = room_structure_code[i][0]
        y1 = room_structure_code[i][1]
        x2 = room_structure_code[i][2]
        y2 = room_structure_code[i][3]

        print_color("yellow", x1,y1,x2,y2)
      }
  }


  //지정영역 색칠하는 함수
  function print_color(color, startx, starty, endx, endy){
    for(var tempx = startx;tempx<=endx;tempx++)
    {
      for(var tempy = starty;tempy<=endy;tempy++)
      {
        change_color_num = tempx * 30 + tempy
        $(".room_one_element").eq(change_color_num).css("background-color",color)    
      }
    }
  }

  

  //방 구조 추가하고, 쓰는 도구 다르게
  //방 번호마다 다른 드래그 하도록 설계한다
  $("#add_room").click(function(){
    
    var new_structure = document.createElement("div")
    new_structure.className = "room_structure"
    new_structure.draggable = "true"
    new_structure.setAttribute("ondragstart","drag_start_room_structure();")
    new_structure.setAttribute("ondragend","drag_end_room_structure();")
    

    new_structure.innerHTML = structure_number
    structure_number = structure_number+1

    var parent = document.getElementById("room_add_parent")
    room_structure_code.push(0);
    console.log(room_structure_code)

    parent.appendChild(new_structure);
    
  });

  //방 구조 박스 클릭하면 색 변하고, 해당 번호를 current_room_structure로
  $(document).on('click', '.room_structure', function(e){
    e.preventDefault()
    if(current_room_structure == $(this).html()-1)
    {
      highlight_room_structure(current_room_structure, "none")
      current_room_structure = -1
      $(this).css('color', 'white')
      $('.room_one_element').css('cursor', 'default')
  
     
    }
    else
    {
      current_room_structure = $(this).html() - 1
      $('.room_structure').css('color', 'white')
      $('.room_one_element').css('border', 'none')
      $('.room_one_element').css('cursor', 'crosshair')
      $(this).css('color', 'red')

      highlight_room_structure(current_room_structure, "5px solid black")
      
    }
   
    console.log(current_room_structure)
  })

  //방구조 drag시작할때 함수
  drag_start_room_structure = function(){
    var dragging_element = event.target
    current_dragging_element_html = dragging_element.innerHTML
  }

  //방구조 drag끝낼때 함수
  drag_end_room_structure = function(){
    
  }

  //드래그 드랍 허용하도록 설정
  allow_room_structure_drop = function(){
    event.preventDefault()
  }
  
  //쓰레기통에 방 구조 drop했을때 함수
  drop_room_strucutre_to_trash = function(){
    var elements = document.getElementsByClassName("room_structure")
    elements[current_dragging_element_html-1].remove();
    console.log("dragging")
    console.log(current_dragging_element_html-1)
    console.log("dragging")

    $('.room_one_element').css('border', 'none')

    //삭제한것 뒤 숫자 변경
    //삭제한것 리스트에서 제거, 재배열
    print_color("green", room_structure_code[current_dragging_element_html-1][0],room_structure_code[current_dragging_element_html-1][1],room_structure_code[current_dragging_element_html-1][2],room_structure_code[current_dragging_element_html-1][3])
    for(var i=current_dragging_element_html-1; i<elements.length;i++)
    {
      elements[i].innerHTML = elements[i].innerHTML-1
      room_structure_code[i] = room_structure_code[i+1]
    }

    

    //방이 선택 되어 있었다면 선택 안되도록
    if(current_room_structure!=-1)
    {
      current_room_structure = -1
      $('.room_one_element').css('cursor', 'default')
    }
  
    structure_number = structure_number-1
    room_structure_code[elements.length] = 0
    current_dragging_element_html = -1

    
    //배열에 있는 나머지 다시 색칠
    print_all_room_structure()
    
    console.log(room_structure_code)
    console.log(current_room_structure)
  }

  //방 주변 강조하는 기능(방 선택 확인 용도)
  //방 구조 리스트의 번호, border텍스트
  highlight_room_structure = function(room_num, border_text){
    var x1 = room_structure_code[room_num][0]
    var y1 = room_structure_code[room_num][1]
    var x2 = room_structure_code[room_num][2]
    var y2 = room_structure_code[room_num][3]

    //위 첫줄 : x1 * 30 + y1 ~ y2
    for(var temp = y1;temp<=y2;temp++)
    {
      change_border_num = x1*30 + temp
      $(".room_one_element").eq(change_border_num).css("border-top",border_text)
    }

    //마지막 첫줄 : x2 * 30 + y1 ~ y2
    for(var temp = y1;temp<=y2;temp++)
    {
      change_border_num = x2*30 + temp
      $(".room_one_element").eq(change_border_num).css("border-bottom",border_text)
    }

    //왼쪽 첫줄 : x1~x2*30 + y1
    for(var temp = x1;temp<=x2;temp++)
    {
      change_border_num = temp*30 + y1
      $(".room_one_element").eq(change_border_num).css("border-left",border_text)
    }

    //오른쪽 첫줄 : x1~x2*30 + y2
    for(var temp = x1;temp<=x2;temp++)
    {
      change_border_num = temp*30 + y2
      $(".room_one_element").eq(change_border_num).css("border-right",border_text)
    }



  }


 




  
  
  
</script>
</body>
</html>